<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>简单卡动画</title>

<script type="text/javascript" src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 100%;
            height: 100%;
            margin: 0;
        }
    </style>
</head>

<body>
    <div id="jsi-cards-container" class="container"></div>

    <script>
        var RENDERER = {
            ROW: 4,
            COLUMN: 12,
            MAX_STATUS_COUNT: 100,
            MAX_WAITING_COUNT: 30,
            MAX_STATUS: 8,

            init: function () {
                this.setParameters();
                this.createCards();
                this.reconstructMethods();
                this.render();
            },
            setParameters: function () {
                this.$container = $('#jsi-cards-container');
                this.width = this.$container.width();
                this.height = this.$container.height();
                this.$canvas = $('<canvas />').attr({
                    width: this.width,
                    height: this.height
                }).appendTo(this.$container);
                this.context = this.$canvas.get(0).getContext('2d');
                this.cards = [];
                this.status = 0;
                this.statusCount = 0;
                this.waitingCount = 0;
                this.gradient = this.context.createRadialGradient(this.width / 2, this.height / 2, 0, this.width /
                    2, this.height /
                    2, Math.sqrt(Math.pow(this.width / 2, 2) + Math.pow(this.height / 2, 2)));
                this.gradient.addColorStop(0, 'hsl(210, 100%, 30%)');
                this.gradient.addColorStop(1, 'hsl(210, 100%, 10%)');
            },
            createCards: function () {
                for (var i = 0; i < this.ROW; i++) {
                    for (var j = 0; j < this.COLUMN; j++) {
                        this.cards.push(new CARD(this, i, j));
                    }
                }
                this.cards.sort(function (card1, card2) {
                    return card2.radian[0] - card1.radian[0];
                });
            },
            reconstructMethods: function () {
                this.render = this.render.bind(this);
            },
            controlStatus: function () {
                if (++this.statusCount > this.MAX_STATUS_COUNT) {
                    if (++this.waitingCount > this.MAX_WAITING_COUNT) {
                        if (++this.status > this.MAX_STATUS) {}
                    }
                }
            },
            easeInOutQuad: function (t) {
                return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
            },
            render: function () {
                requestAnimationFrame(this.render);
                this.context.fillStyle = this.gradient;
                this.context.fillRect(0, 0, this.width, this.height);
                var rate = this.easeInOutQuad(Math.min(1, this.statusCount / this.MAX_STATUS_COUNT));

                for (var i = 0, length = this.cards.length; i < length; i++) {
                    this.cards[i].render(this.context, this.status, rate);
                }
                this.controlStatus();
            }
        };
        var CARD = function (renderer, row, column) {
            this.renderer = renderer;
            this.row = row;
            this.column = column;
            this.init();
        };
        CARD.prototype = {
            WIDTH_LENGTH: 10,
            HEIGHT_LENGTH: 25,
            init: function () {
                var index = this.column * this.renderer.ROW + this.row;
                this.width = this.WIDTH_LENGTH;
                this.height = this.HEIGHT_LENGTH;
                this.radian = [index / this.renderer.ROW / this.renderer.COLUMN, this.column / this.renderer.COLUMN,
                    this.row / (this.renderer.ROW - 1)
                ];
                this.hue = this.radian[0] * 360 | 0;
            },
            controlStatus: function (context, status, rate) {
                this.x = this.renderer.width / 2;
                this.y = this.renderer.height / 2;
                context.rotate(this.radian[0] * Math.PI * 2 * rate);
                context.translate(0, -this.height * 4);
            },
            render: function (context, status, rate) {
                context.save();
                context.translate(this.x, this.y);
                this.controlStatus(context, status, rate);
                context.lineWidth = this.width / 20;
                context.strokeStyle = 'hsl(' + this.hue + ', 60%, 90%)';
                context.fillStyle = 'hsl(' + this.hue + ', 60%, 60%)';
                context.fillRect(0, -this.height, this.width, this.height);
                context.strokeRect(0, -this.height, this.width, this.height);
                context.restore();
            }
        };
        $(function () {
            RENDERER.init();
        });
    </script>
</body>

</html>